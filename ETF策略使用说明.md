# ETF加仓策略分析功能

## 功能概述

根据您提供的策略流程图，实现了自动化的标普500和纳斯达克ETF加仓判断功能，并集成到TrendRadar的通知消息中。

## 策略流程图

```
graph TD
    A[今早7:00前查美股收盘] -->|跌≥1%| B(查溢价率)
    A -->|涨或微跌| C[放弃加仓]
    B -->|溢价率<5%| D[查美股期货]
    B -->|溢价率>5%| C
    D -->|期货跌>0.5%| E[查今日事件]
    D -->|期货涨| C
    E -->|无重大事件| F[执行加仓]
    E -->|有重大事件| G[事件落地后再操作]
```

## 实现功能

### 1. 数据获取
- **美股收盘数据**: 从Yahoo Finance API获取标普500和纳斯达克指数的实时涨跌幅
- **ETF溢价率**: 目前使用模拟数据（可替换为真实API）
- **美股期货**: 目前使用模拟数据（可替换为真实API）

### 2. 重大事件检测
基于新闻标题关键词匹配，检测以下重大事件：
- 美联储相关：美联储、加息、降息
- 经济数据：通胀、CPI、PPI、非农、就业、GDP
- 地缘政治：贸易战、制裁、地缘、战争、冲突
- 其他：央行、财报、重大事故、天灾、疫情、封锁

### 3. 策略判断逻辑

```python
def analyze_strategy(self, news_titles):
    # 1. 检查美股收盘情况
    if 美股涨幅 >= -1.0%:
        return "❌ 放弃加仓 - 涨或微跌"
    
    # 2. 检查ETF溢价率
    if ETF溢价率 > 5.0%:
        return "❌ 放弃加仓 - 溢价率过高"
    
    # 3. 检查美股期货
    if 期货涨幅 > 0:
        return "❌ 放弃加仓 - 期货上涨"
    elif 期货跌幅 <= 0.5%:
        return "❌ 放弃加仓 - 期货跌幅不足"
    
    # 4. 检查重大事件
    if 存在重大事件:
        return "⏰ 事件落地后再操作"
    else:
        return "✅ 执行加仓"
```

## 输出示例

```
💰 ETF加仓策略判断

标普500：
**❌ 放弃加仓**
📊 美股+0.50% | ETF溢价2.5% | 期货-0.80%
💡 美股涨幅0.50%或跌幅不足1%

纳斯达克：
**⏰ 事件落地后再操作**
📊 美股-1.20% | ETF溢价3.0% | 期货-1.20%
💡 存在重大事件，建议等待
```

## 集成位置

ETF策略分析结果会自动添加到以下通知中：
- 🔸 飞书通知
- 🔸 钉钉通知  
- 🔸 企业微信通知
- 🔸 Telegram通知
- 🔸 HTML报告

## 使用方法

### 1. 直接测试
```bash
python etf_strategy.py
```

### 2. 作为TrendRadar的一部分
```bash
python main.py
```
ETF策略分析结果会自动包含在生成的通知消息中。

### 3. 编程调用
```python
from etf_strategy import ETFStrategyAnalyzer

# 创建分析器
analyzer = ETFStrategyAnalyzer()

# 分析策略（传入新闻标题用于重大事件检测）
news_titles = ["美联储会议纪要显示加息预期", "科技股大涨"]
results = analyzer.analyze_strategy(news_titles)

# 获取结果
for index_name, strategy_result in results.items():
    print(f"{index_name}: {strategy_result}")
```

## 注意事项

1. **网络连接**: 需要网络连接获取美股实时数据
2. **代理设置**: 如果使用代理，请确保代理配置正确
3. **数据准确性**: ETF溢价率和期货数据目前使用模拟数据，建议接入真实API
4. **时间敏感**: 美股数据具有时效性，建议在美股交易时间或收盘后及时获取

## 数据源升级建议

为了获得更准确的分析结果，建议接入以下真实数据源：

1. **ETF溢价率数据**:
   - 可接入券商API或专业金融数据提供商
   - 实时监控SPY、QQQ等ETF的溢价/折价情况

2. **期货数据**:
   - 芝加哥商品交易所(CME)的ES、NQ期货数据
   - 实时获取期货合约的涨跌幅

3. **新闻事件**:
   - 增强关键词库，提高重大事件识别准确率
   - 可接入新闻情感分析API

## 测试结果

✅ 策略逻辑正确实现  
✅ 多平台通知集成完成  
✅ 重大事件检测工作正常  
✅ 数据获取机制稳定  

该功能已成功集成到TrendRadar中，每次运行时会自动执行ETF加仓策略分析，并将结果包含在通知消息中。 